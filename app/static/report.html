<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Usage Summary</title>
</head>
<body>
  <h1>Application Usage Summary</h1>

  <button id="show-stats-btn">Load Stats</button>

  <div id="stats-container" style="margin-top: 1rem; padding: 0.5rem; border: 1px solid #ccc;">
    <p id="stats-total">Total calculations: -</p>
    <p id="stats-last">Last calculation at: -</p>
    <ul id="stats-per-operation"></ul>
  </div>

  <script>
    async function fetchStats() {
      try {
        const response = await fetch("http://127.0.0.1:8000/reports/summary", {
          method: "GET",
          headers: {
            "Accept": "application/json"
          }
        });

        if (!response.ok) {
          const errText = await response.text();
          console.error("Error:", errText);
          alert("Could not fetch stats.");
          return;
        }

        const data = await response.json();

        document.getElementById("stats-total").textContent =
          "Total calculations: " + data.total_calculations;

        document.getElementById("stats-last").textContent =
          "Last calculation at: " + (data.last_calculation_at || "N/A");

        const list = document.getElementById("stats-per-operation");
        list.innerHTML = "";

        if (data.per_operation.length === 0) {
          const li = document.createElement("li");
          li.textContent = "No calculations yet.";
          list.appendChild(li);
        } else {
          data.per_operation.forEach(item => {
            const li = document.createElement("li");
            li.textContent = item.operator + ": " + item.count;
            list.appendChild(li);
          });
        }

      } catch (e) {
        console.error(e);
        alert("Something went wrong while loading stats.");
      }
    }

    document
      .getElementById("show-stats-btn")
      .addEventListener("click", fetchStats);
  </script>
</body>
</html>
